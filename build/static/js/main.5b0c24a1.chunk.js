(this["webpackJsonpgv-targeterfassung"]=this["webpackJsonpgv-targeterfassung"]||[]).push([[0],{80:function(e,n,t){e.exports=t(98)},86:function(e,n,t){},97:function(e,n,t){},98:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(9),c=t.n(o),i=t(39),u=t(49),l=t(26),s=t(36),m=t.n(s),f=t(50),d=t(101),g=t(135),p=t(139),h=t(133),v=t(128),b=t(100),E=t(59),w=t.n(E),k=(t(86),t(130)),D=t(64),j=t.n(D),y=t(51),S=t.n(y),x=Object(v.a)((function(e){return{button:{margin:e.spacing(1),padding:"10px 20px",fontSize:"1rem",textTransform:"none"},buttonContainer:{display:"flex",flexDirection:"row",alignItems:"center"}}})),C=function(e){var n=e.handleSubmit,t=e.downloadCombinedTodayData,a=e.downloadCombinedData,o=x();return r.a.createElement(g.a,null,r.a.createElement(k.a,{variant:"contained",color:"primary",className:o.button,endIcon:r.a.createElement(j.a,null),onClick:n},"Abschicken"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(g.a,{className:o.buttonContainer},r.a.createElement(k.a,{variant:"contained",color:"primary",className:o.button,startIcon:r.a.createElement(S.a,null),onClick:function(){return t()}},"Daten von heute herunterladen"),r.a.createElement(k.a,{variant:"contained",color:"primary",className:o.button,startIcon:r.a.createElement(S.a,null),onClick:function(){return a()}},"Alle Daten herunterladen")))},O=t(140),I=t(138),W=t(132),L=t(136),R=t(134),P=Object(v.a)((function(e){return{title:{fontWeight:"bold",fontSize:"1.2rem",marginBottom:"5px"}}})),N=function(e){var n=e.formData,t=e.handleInputChange,o=e.handlePhotoChange,c=e.currentDate,i=e.setCurrentDate,u=e.reff;Object(a.useEffect)((function(){i((new Date).toISOString().slice(0,10))}),[]);var l=P();return r.a.createElement(g.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"400px",margin:"0 auto",padding:"20px",border:"1px solid #ccc",borderRadius:"8px",boxShadow:"0 0 5px rgba(0, 0, 0, 0.2)"},r.a.createElement(b.a,{variant:"h5",className:l.title},"Streckennummer"),r.a.createElement(R.a,{required:!0,fullWidth:!0,name:"streckennummer",type:"number",value:n.streckennummer,onChange:t,margin:"normal",onInput:function(e){e.target.value=Math.max(0,parseInt(e.target.value)).toString().slice(0,4)}}),r.a.createElement(b.a,{variant:"h6",className:l.title},"Kilometrierung"),r.a.createElement(g.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(R.a,{required:!0,style:{marginRight:"10px"},id:"km",name:"km",type:"number",placeholder:"z.B. 145",value:n.km,onChange:t}),r.a.createElement(R.a,{required:!0,id:"met",name:"met",type:"number",placeholder:"02",value:n.met,onChange:t})),r.a.createElement(b.a,{variant:"h6",className:l.title},"Seite"),r.a.createElement(g.a,{display:"flex",flexDirection:"row",alignItems:"center"},r.a.createElement(O.a,{component:"fieldset"},r.a.createElement(I.a,{row:!0,required:!0,id:"seite",name:"seite",value:n.seite,onChange:t},r.a.createElement(W.a,{value:"L",control:r.a.createElement(L.a,null),label:"L"}),r.a.createElement(W.a,{value:"R",control:r.a.createElement(L.a,null),label:"R"}))),r.a.createElement(R.a,{fullWidth:!0,label:"Sonstiges",id:"sonstiges",name:"sonstiges",value:n.sonstiges,onChange:n.handleChange})),r.a.createElement(b.a,{variant:"h6",className:l.title},"Punktnummer"),r.a.createElement(R.a,{required:!0,fullWidth:!0,name:"punktnummer",value:n.punktnummer,onChange:t,margin:"normal"}),r.a.createElement(b.a,{variant:"h6",className:l.title},"GVP L\xe4nge, mm"),r.a.createElement(R.a,{required:!0,fullWidth:!0,name:"gvp",value:n.gvp,onChange:t,margin:"normal"}),r.a.createElement(b.a,{variant:"h6",className:l.title},"Datum"),r.a.createElement(R.a,{required:!0,fullWidth:!0,name:"currentDate",value:c,onChange:function(e){i(e.target.value)},margin:"normal"}),r.a.createElement(b.a,{variant:"h6",className:l.title},"Foto hochladen"),r.a.createElement("input",{ref:function(e){return u.current=e},required:!0,type:"file",name:"photo",accept:"image/*;capture=camera",onChange:o}))};function A(){return new Promise((function(e,n){var t=indexedDB.open("Au\xdfendienstDB",1);t.onupgradeneeded=function(e){e.target.result.createObjectStore("submissions",{keyPath:"id",autoIncrement:!0})},t.onsuccess=function(n){var t=n.target.result;e(t)},t.onerror=function(e){n(e.target.error)}}))}function _(e){return new Promise((function(n,t){var a=e.transaction(["submissions"],"readonly").objectStore("submissions").getAll();a.onsuccess=function(){n(a.result)},a.onerror=function(){t(a.error)}}))}var U=t(52),B=t.n(U),q=Object(v.a)((function(e){return{root:{flexWrap:"wrap",width:"100%",height:"100%",backgroundColor:"#f4f4f4",display:"flex",justifyContent:"center","& > *":{padding:"20px",display:"flex",flexDirection:"column"}}}})),z=function(){var e=Object(f.a)(m.a.mark((function e(n){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var a=n.transaction(["submissions"],"readwrite").objectStore("submissions").clear();a.onsuccess=function(){e()},a.onerror=function(e){t(e.target.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();var F=function(){var e=q(),n=Object(a.useState)({streckennummer:"",km:"",met:"",seite:!1,sonstiges:"",punktnummer:"",gvp:"",photo:null}),t=Object(l.a)(n,2),o=t[0],c=t[1],s=Object(a.useRef)(null);Object(a.useEffect)((function(){var e=setInterval(function(){var e=Object(f.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A();case 3:return n=e.sent,e.next=6,z(n);case 6:console.log("IndexedDB cleared."),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error clearing IndexedDB: ",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),12096e5);return function(){clearInterval(e)}}),[]);var v=Object(a.useState)([]),E=Object(l.a)(v,2),k=E[0],D=E[1],j=Object(a.useState)(!1),y=Object(l.a)(j,2),S=(y[0],y[1]),x=Object(a.useState)(""),O=Object(l.a)(x,2),I=O[0],W=O[1],L=Object(a.useState)(""),R=Object(l.a)(L,2),P=R[0],U=R[1],F=Object(a.useState)(""),T=Object(l.a)(F,2),G=T[0],V=T[1];return Object(a.useEffect)((function(){A().then((function(e){_(e).then((function(e){return D(e)}))})).catch((function(e){return console.error("Error opening database: ",e)}))}),[]),r.a.createElement("div",{className:w()(e.root,"appWrapper")},r.a.createElement(d.a,{elevation:3,classes:e.paper},r.a.createElement(g.a,null,r.a.createElement(b.a,{style:{padding:16},variant:"h4"},"Die GV-Targeterfassung")),r.a.createElement(N,{reff:s,formData:o,handleInputChange:function(e){var n=e.target,t=n.name,a=n.value;c(Object(u.a)({},o,Object(i.a)({},t,a)))},handlePhotoChange:function(e){var n=e.target.files[0];c(Object(u.a)({},o,{photo:n}))},currentDate:G,setCurrentDate:V}),r.a.createElement(C,{handleSubmit:function(){if(!o.photo)return U("Bitte w\xe4hlen Sie ein Foto aus, bevor Sie fortfahren."),void W("");U(""),W("Erfolgreich hinzugef\xfcgt"),c({streckennummer:"",km:"",met:"",seite:"",sonstiges:"",punktnummer:"",gvp:"",photo:null});var e=new FileReader;e.onload=function(e){var n=e.target.result,t=.9,a=new Image;a.src=n,a.onload=function(){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=a.width,e.height=a.height,n.drawImage(a,0,0,a.width,a.height);for(var r=e.toDataURL("image/jpeg",t);r.length>524288&&t>=.1;)t-=.1,r=e.toDataURL("image/jpeg",t);if(r.length<=524288){var c={streckennummer:o.streckennummer,km:o.km,met:o.met,seite:o.seite,sonstiges:o.sonstiges,punktnummer:o.punktnummer,gvp:o.gvp,currentDate:G,photo:r};A().then((function(e){(function(e,n){return new Promise((function(t,a){var r=e.transaction(["submissions"],"readwrite").objectStore("submissions").add(n);r.onsuccess=function(){t()},r.onerror=function(){a(r.error)}}))})(e,c).then((function(){_(e).then((function(e){D(e),W("Erfolgreich hinzugef\xfcgt"),S(!0)})).catch((function(e){return console.error("Error fetching submissions: ",e)}))})).catch((function(e){return console.error("Error adding submission: ",e)}))})).catch((function(e){return console.error("Error opening database: ",e)}))}else console.error("Compressed photo size is still too large.")}},e.readAsDataURL(o.photo),s.current.value=""},downloadCombinedData:function(){var e=new B.a,n="Streckennummer;Kilometrierung; Seite; Sonstiges; Punktnummer; GVP L\xe4nge; Datum\n"+k.map((function(e){var n=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.punktnummer,";").concat(n,";").concat(e.currentDate)})).join("\n");e.file("alle_daten.csv",n),k.forEach((function(n,t){var a=n.currentDate.replace(/-/g,""),r="".concat(n.streckennummer,"_").concat(n.km,",").concat(n.met,"_").concat(n.seite,"_").concat(n.punktnummer,"_").concat(a,".jpg"),o=n.photo.split(",")[1];e.file(r,o,{base64:!0})})),e.generateAsync({type:"blob"}).then((function(e){var n=window.URL.createObjectURL(e),t=document.createElement("a");t.href=n,t.download="combined_data.zip",t.click()}))},downloadCombinedTodayData:function(){var e=new B.a,n=k.filter((function(e){return e.currentDate===G})),t="Streckennummer;Kilometrierung; Seite; Sonstiges; Punktnummer; GVP L\xe4nge; Datum\n"+n.map((function(e){var n=(e.gvp/1e3).toLocaleString("de-DE",{minimumFractionDigits:2});return"".concat(e.streckennummer,";").concat(e.km,",").concat(e.met,";").concat(e.seite,";").concat(e.sonstiges,";").concat(e.punktnummer,";").concat(n,";").concat(G)})).join("\n");e.file("daten_von_heute.csv",t),n.forEach((function(n,t){var a=n.currentDate.replace(/-/g,""),r="".concat(n.streckennummer,"_").concat(n.km,",").concat(n.met,"_").concat(n.seite,"_").concat(n.punktnummer,"_").concat(a,".jpg"),o=n.photo.split(",")[1];e.file(r,o,{base64:!0})})),e.generateAsync({type:"blob"}).then((function(e){var n=(new Date).toISOString().slice(0,10),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="".concat(n,".zip"),a.click()}))}})),r.a.createElement(p.a,{open:!!I,autoHideDuration:6e3,onClose:function(e,n){"clickaway"!==n&&W("")}},r.a.createElement(h.a,{message:I,style:{backgroundColor:"#92b493"}})),r.a.createElement(p.a,{open:!!P,autoHideDuration:6e3,onClose:function(e,n){"clickaway"!==n&&U("")}},r.a.createElement(h.a,{message:P,style:{backgroundColor:"#FF5722"}})))},T=(t(97),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function G(e,n){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;null!=t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),n&&n.onUpdate&&n.onUpdate(e)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(F,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/gv-targeterfassung-app",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var n="".concat("/gv-targeterfassung-app","/service-worker.js");T?(!function(e,n){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(t){var a=t.headers.get("content-type");404===t.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):G(e,n)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(n,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):G(n,e)}))}}()}},[[80,1,2]]]);
//# sourceMappingURL=main.5b0c24a1.chunk.js.map